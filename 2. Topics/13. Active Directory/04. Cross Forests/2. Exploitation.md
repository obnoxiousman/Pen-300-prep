## Exploiting Misconfiguration
Forest trust introduces the concept of _SID filtering_. 
In forest trust, the contents of the ExtraSids field are filtered so group memberships are not blindly trusted.

Even if we compromise the krbtgt hash, we cannot simply jump a forest due to the implication of SID filtering.
We can use _Netdom_ on the domain controller of the incoming trust to _allow SID history_, which eases the strict SID filtering.

SID filtering can be removed by enterprises to merge 2 forests, by transferring users and letting the users of the new forest, access the services of the old forest.
SID history was designed to address this, and during the migration period, corp2.com would disable SID filtering.

To enumerate if SID history is enabled/disabled we can use the following command:
```Powershell
Get-DomainTrust -Domain corp2.com
```
The interesting property in this output is _TrustAttributes_.

When SID filtering is enabled in the domain controller of the other forest with netdom:
```Powershell
netdom trust corp2.com /d:corp1.com /enablesidhistory:yes
```

Running the same command again shows a new parameter in the _trustAttributes_ i.e. 
_TREAT_AS_EXTERNAL_ which indicates that the forest trust is instead treated as an external trust but with the transitivity of normal forest trust.

With SID history enabled- we still need to deal with one problem.
While we enabled SID history, SID filtering is still active.
Microsoft dictated that any SID with a RID less than 1000 will always be filtered regardless of the SID history setting.
However, a SID with a RID equal to or higher than 1000 is not filtered for external trust.

To deal with this, we can enumerate any users with an RID of higher than 1000.
```Powershell
Get-DomainGroupMember -Identity "Administrators" -Domain corp2.com
```

One final problem we may run is that, if the custom group we attempt to abuse is a member a _global security group_ like Domain Admins or Enterprise Admins, that access will also be filtered.
Only group membership in _domain local security_ groups is not filtered.